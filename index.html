<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Chaves Rumble</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#87ceeb;
  font-family:Arial;
}
#menu{
  position:absolute;
  inset:0;
  background:#222;
  color:#fff;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:15px;
  z-index:10;
}
button{
  padding:14px 24px;
  font-size:18px;
  border:none;
  border-radius:10px;
}
#hud{
  position:absolute;
  top:10px;
  left:10px;
  background:rgba(0,0,0,.5);
  color:white;
  padding:8px 12px;
  border-radius:8px;
}
</style>
</head>

<body>

<div id="menu">
  <h1>CHAVES RUMBLE 🌀</h1>
  <button onclick="start('pc')">💻 PC</button>
  <button onclick="start('mobile')">📱 Celular</button>
  <button onclick="start('xbox')">🎮 Xbox (Dev Mode)</button>
</div>

<div id="hud">Carregando…</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
/* ===== VARIÁVEIS ===== */
let device=null, player=null, mixer=null;
const keys={}, speed=0.12;
let vy=0, gravity=-0.02;

/* ===== INICIAR ===== */
function start(type){
  device=type;
  menu.style.display="none";
  hud.innerText="Dispositivo: "+type.toUpperCase();
}

/* ===== THREE ===== */
const scene=new THREE.Scene();
scene.add(new THREE.AmbientLight(0xffffff,.7));

const light=new THREE.DirectionalLight(0xffffff,.6);
light.position.set(5,10,5);
scene.add(light);

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
camera.position.set(0,6,8);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

/* ===== LOADERS ===== */
const loader=new THREE.GLTFLoader();

/* MAPA - VILA */
loader.load("models/village/scene.gltf",(gltf)=>{
  const vila=gltf.scene;
  vila.scale.set(1,1,1);
  scene.add(vila);
});

/* PLAYER - CHAVO */
loader.load("models/chavo/scene.gltf",(gltf)=>{
  player=gltf.scene;
  player.scale.set(1,1,1);     // se ficar gigante: 0.01
  player.position.set(0,0,0);
  player.rotation.y=Math.PI;
  scene.add(player);

  if(gltf.animations.length){
    mixer=new THREE.AnimationMixer(player);
    mixer.clipAction(gltf.animations[0]).play();
  }
});

/* ===== INPUT ===== */
addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

function gamepad(){
  const g=navigator.getGamepads()[0];
  if(!g||!player)return;
  if(g.axes[0]<-0.3)player.position.x-=speed;
  if(g.axes[0]>0.3) player.position.x+=speed;
  if(g.axes[1]<-0.3)player.position.z-=speed;
  if(g.axes[1]>0.3) player.position.z+=speed;
  if(g.buttons[0].pressed)jump();
}

/* ===== JOGO ===== */
function jump(){
  if(player.position.y<=0.01)vy=0.4;
}

function loop(){
  requestAnimationFrame(loop);

  if(player){
    if(device!=="xbox"){
      if(keys.a)player.position.x-=speed;
      if(keys.d)player.position.x+=speed;
      if(keys.w)player.position.z-=speed;
      if(keys.s)player.position.z+=speed;
      if(keys[" "])jump();
    } else gamepad();

    vy+=gravity;
    player.position.y+=vy;
    if(player.position.y<0){player.position.y=0;vy=0;}

    if(Math.abs(player.position.x)>10||Math.abs(player.position.z)>10)
      player.position.set(0,0,0);
  }

  if(mixer)mixer.update(0.016);
  renderer.render(scene,camera);
}
loop();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>

